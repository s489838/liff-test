<!DOCTYPE html>
<html>
<head>
    <title>LIFF Phone Scope æ¸¬è©¦</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://static.line-scdn.net/liff/sdk/2.20.0/liff.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #00b900; }
        pre { background-color: #eee; padding: 10px; border-radius: 4px; white-space: pre-wrap; word-break: break-all; }
        .status-box { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background-color: #e6ffe6; border: 1px solid #00b900; }
        .error { background-color: #ffe6e6; border: 1px solid #ff4d4d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ LIFF æ¸¬è©¦</h1>
        <p>è«‹ç¢ºèªæ­¤ LIFF App å·²åœ¨ LINE Developer Console ä¸­è¨­å®š **scope: phone**ã€‚</p>
        <div id="liff-status" class="status-box">æ­£åœ¨åˆå§‹åŒ– LIFF...</div>

        <h2>çµæœï¼š</h2>
        <div id="results" class="status-box">ç­‰å¾…è³‡æ–™å–å¾—...</div>

        <h2>åŸå§‹ ID Token è³‡æ–™ (JSON):</h2>
        <pre id="raw-data">ç„¡è³‡æ–™</pre>
    </div>

    <script>
        // *** è«‹å°‡ YOUR_LIFF_ID_HERE æ›¿æ›ç‚ºæ‚¨çš„ LIFF ID ***
        const LIFF_ID = "2007557804-VzprogWq"; 

        document.addEventListener('DOMContentLoaded', function() {
            // é¡¯ç¤ºç‹€æ…‹çš„ DOM å…ƒç´ 
            const statusElement = document.getElementById('liff-status');
            const resultsElement = document.getElementById('results');
            const rawDataElement = document.getElementById('raw-data');

            liff.init({ liffId: LIFF_ID })
                .then(() => {
                    statusElement.textContent = 'LIFF åˆå§‹åŒ–æˆåŠŸã€‚';
                    statusElement.classList.add('success');
                    handleLogin();
                })
                .catch((err) => {
                    statusElement.textContent = `LIFF åˆå§‹åŒ–å¤±æ•—ï¼š${err.code} ${err.message}`;
                    statusElement.classList.add('error');
                });
            
            function handleLogin() {
                if (!liff.isLoggedIn()) {
                    // å¦‚æœç”¨æˆ¶æœªç™»å…¥ï¼ŒåŸ·è¡Œç™»å…¥ã€‚
                    // redirectUri æœƒåœ¨æˆæ¬Šå¾Œè·³å›ç›®å‰çš„é é¢ã€‚
                    // é—œéµï¼šåœ¨ç™»å…¥æ™‚è¦æ±‚ 'phone' scopeã€‚
                    liff.login({ 
                        scope: 'profile openid phone', 
                        redirectUri: window.location.href 
                    });
                } else {
                    // å¦‚æœå·²ç™»å…¥ï¼Œå˜—è©¦å–å¾—è³‡æ–™
                    fetchData();
                }
            }

            function fetchData() {
                if (!liff.getIDToken()) {
                    resultsElement.textContent = 'ç„¡æ³•å–å¾— ID Tokenï¼Œè«‹ç¢ºä¿æ‚¨æ˜¯é€é LIFF ç™»å…¥ï¼Œä¸¦å·²åœ¨ LINE Developer Console ä¸­å•Ÿç”¨ ID Tokenã€‚';
                    resultsElement.classList.add('error');
                    return;
                }

                try {
                    // liff.getDecodedIDToken() æœƒå°‡ JWT è§£æç‚º JSON ç‰©ä»¶
                    const idTokenData = liff.getDecodedIDToken();

                    // å°‡åŸå§‹è³‡æ–™é¡¯ç¤ºåœ¨é é¢ä¸Š
                    rawDataElement.textContent = JSON.stringify(idTokenData, null, 2);

                    const userId = idTokenData.sub;
                    const userPhone = idTokenData.phone;
                    const userName = idTokenData.name || idTokenData.given_name;

                    if (userPhone) {
                        resultsElement.innerHTML = `
                            <strong>âœ… æ­å–œï¼æˆåŠŸå–å¾—é›»è©±è™Ÿç¢¼ï¼</strong><br>
                            LINE User ID: ${userId}<br>
                            ç”¨æˆ¶åç¨±: ${userName || 'N/A'}<br>
                            <strong>é›»è©±è™Ÿç¢¼: ${userPhone}</strong>
                        `;
                        resultsElement.classList.add('success');
                        resultsElement.classList.remove('error');
                    } else {
                        resultsElement.innerHTML = `
                            <strong>âš ï¸ æœªå–å¾—é›»è©±è™Ÿç¢¼</strong><br>
                            LINE User ID: ${userId}<br>
                            ç”¨æˆ¶åç¨±: ${userName || 'N/A'}<br>
                            å¯èƒ½åŸå› ï¼š<br>
                            1. æ‚¨åœ¨æˆæ¬Šç•«é¢ä¸­**æ‹’çµ•**æä¾›é›»è©±è™Ÿç¢¼ã€‚<br>
                            2. æ‚¨ä¸æ˜¯æ­¤å®˜æ–¹å¸³è™Ÿçš„**å¥½å‹**ã€‚<br>
                            3. æ‚¨ä¹‹å‰å·²æˆæ¬Šï¼Œä½†ç•¶æ™‚ LIFF **æœªè¨­å®š** 'phone' scope (è«‹æ¸…é™¤æˆæ¬Šç´€éŒ„å¾Œé‡è©¦)ã€‚
                        `;
                        resultsElement.classList.add('error');
                        resultsElement.classList.remove('success');
                    }
                } catch (error) {
                    resultsElement.textContent = 'è§£æ ID Token æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message;
                    resultsElement.classList.add('error');
                    resultsElement.classList.remove('success');
                }
            }
        });
    </script>
</body>
</html>