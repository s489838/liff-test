<!DOCTYPE html>
<html>
<head>
    <title>LIFFæ¸¬è©¦</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script charset="UTF-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #f4f4f9; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        h1 { color: #00b900; }
        pre { background-color: #eee; padding: 10px; border-radius: 4px; white-space: pre-wrap; word-break: break-all; }
        .status-box { margin-top: 20px; padding: 15px; border-radius: 4px; }
        .success { background-color: #e6ffe6; border: 1px solid #00b900; }
        .error { background-color: #ffe6e6; border: 1px solid #ff4d4d; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ LIFF æ¸¬è©¦</h1>
        <div id="info" class="status-box">æ­£åœ¨è¼‰å…¥è³‡è¨Š...</div>
    </div>
    <script>
        // ç­‰å¾… LIFF SDK è¼‰å…¥
        window.addEventListener('load', function() {
            if (typeof liff === 'undefined') {
                document.getElementById('info').textContent = 'LIFF SDK æœªè¼‰å…¥ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–é‡æ–°æ•´ç†é é¢ã€‚';
                document.getElementById('info').classList.add('error');
            } else {
                liff.init({ liffId: "2007557804-VzprogWq" })
                .then(() => {
                    console.log("LIFF initialized");
                    displayInfo();
                })
                .catch((err) => {
                    console.error("LIFF initialization failed", err);
                    document.getElementById('info').textContent = 'LIFF åˆå§‹åŒ–å¤±æ•—: ' + err.message;
                    document.getElementById('info').classList.add('error');
                });
            }
        });

        async function displayInfo() {
            try {
                const os = liff.getOS();
                const isInClient = liff.isInClient();
                const isLoggedIn = liff.isLoggedIn();
                let profile = 'æœªç™»å…¥';
                let phoneNumber = 'ç„¡';
                
                if (isLoggedIn) {
                    profile = await liff.getProfile();
                    profile = JSON.stringify(profile, null, 2);
                    
                    // å–å¾— ID Token ä¸­çš„é›»è©±è™Ÿç¢¼
                    const idToken = liff.getDecodedIDToken();
                    if (idToken && idToken.phone_number) {
                        phoneNumber = idToken.phone_number;
                    }
                }
                
                document.getElementById('info').innerHTML = `
                    <strong>ä½œæ¥­ç³»çµ±:</strong> ${os}<br>
                    <strong>æ˜¯å¦åœ¨ LINE å…§å»ºç€è¦½å™¨:</strong> ${isInClient}<br>
                    <strong>æ˜¯å¦å·²ç™»å…¥:</strong> ${isLoggedIn}<br>
                    <strong>é›»è©±è™Ÿç¢¼:</strong> ${phoneNumber}<br>
                    <strong>å€‹äººè³‡æ–™:</strong><br><pre>${profile}</pre>
                `;
                document.getElementById('info').classList.add('success');
            } catch (error) {
                document.getElementById('info').textContent = 'å–å¾—è³‡è¨Šæ™‚ç™¼ç”ŸéŒ¯èª¤: ' + error.message;
                document.getElementById('info').classList.add('error');
            }
        }
    </script>
</body>
</html>
